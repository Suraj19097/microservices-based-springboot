<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add/Edit Vendor</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container">
    <h1 class="mt-4" id="form-title">Add New Vendor</h1>

    <form id="vendor-form">
        <input type="hidden" id="vendorId" name="vendorId">
        <div class="form-group">
            <label for="vendorName">Vendor Name:</label>
            <input type="text" class="form-control" id="vendorName" name="vendorName" required>
        </div>
        <div class="form-group">
            <label for="vendorAddress">Vendor Address:</label>
            <input type="text" class="form-control" id="vendorAddress" name="vendorAddress" required>
        </div>
        <div class="form-group">
            <label for="vendorPhoneNumber">Vendor Phone Number:</label>
            <input type="text" class="form-control" id="vendorPhoneNumber" name="vendorPhoneNumber" required>
        </div>
        <button type="submit" class="btn btn-primary">Save Vendor</button>
        <a href="vendor.html" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
    const API_URL = "http://35.153.203.192:8081/vendor"; // Backend API URL
    const urlParams = new URLSearchParams(window.location.search);
    const vendorId = urlParams.get("vendorId");

    // Populate form if editing
    async function loadVendorData() {
        if (vendorId) {
            document.getElementById("form-title").textContent = "Edit Vendor";
            try {
                const response = await fetch(`${API_URL}/${vendorId}`);
                const vendor = await response.json();

                document.getElementById("vendorId").value = vendor.vendorId;
                document.getElementById("vendorName").value = vendor.vendorName;
                document.getElementById("vendorAddress").value = vendor.vendorAddress;
                document.getElementById("vendorPhoneNumber").value = vendor.vendorPhoneNumber;
            } catch (error) {
                console.error("Error loading vendor data:", error);
            }
        }
    }

    // Save Vendor (Create or Update)
    document.getElementById("vendor-form").addEventListener("submit", async function (event) {
        event.preventDefault();

        const vendorData = {
            vendorName: document.getElementById("vendorName").value,
            vendorAddress: document.getElementById("vendorAddress").value,
            vendorPhoneNumber: document.getElementById("vendorPhoneNumber").value,
        };

        const method = vendorId ? "PUT" : "POST";
        const endpoint = vendorId ? `${API_URL}/${vendorId}` : API_URL;

        try {
            const response = await fetch(endpoint, {
                method: method,
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(vendorData),
            });

            if (response.ok) {
                alert(vendorId ? "Vendor updated successfully!" : "Vendor added successfully!");
                window.location.href = "vendor.html";
            } else {
                alert("Error saving vendor!");
            }
        } catch (error) {
            console.error("Error saving vendor:", error);
        }
    });

    // Load data for edit mode
    window.onload = loadVendorData;
</script>

</body>
</html>

